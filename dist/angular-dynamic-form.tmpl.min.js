"use strict";!function(){angular.module("AngularDynamicForm",["angular.filter"])}(),function(){var a=function(){this.repo={},this.set=function(a,b){this.repo[a]=b},this.get=function(a,b,c){if(!_.has(this.repo,a)&&!_.isUndefined(b))return b;if(!_.has(this.repo,a))return null;var d=this.repo[a];return c&&delete this.repo[a],d},this.remove=function(a){delete this.repo[a]}};angular.module("AngularDynamicForm").service("DynamicFormStateService",a)}(),function(){var a=function(){this.format={date:{display:"DD-MM-YYYY",mysql:"YYYY-MM-DD"},time:{display:"HH:mm:SS",mysql:"HH:mm:SS"}},this.slugify=function(a,b,c){return _.isUndefined(c)&&(c="-"),_.isString(a)?(b?(a=a.replace(/^[A-Z]/,function(a){return a.toLowerCase()}),a=a.replace(/[A-Z]/g,function(a){return c+a.toLowerCase()})):a=a.toLowerCase(),a=a.replace(/\s+/g,c),a=a.replace(/\.+/g,c)):a="","-"===c&&(a=a.replace(/(\-{2})/g,c)),"_"===c&&(a=a.replace(/(\_{2})/g,c)),a},this.deslugify=function(a){return a.toLowerCase().replace(/[\.\-]+/g," ").replace(/(?:^|\s)\w/g,function(a){return a.toUpperCase()}).replace(/\s+/g,"")},this.formatDateForDisplay=function(a){var b;return _.isUndefined(a)||_.isNull(a)?void 0:(_.isString(a)?(b=moment(a,this.format.date.mysql),b.isValid()||(b=moment(a,this.format.date.display))):b=moment(a),b.format(this.format.date.display))},this.formatDateForMySQL=function(a){var b;return _.isUndefined(a)||_.isNull(a)?void 0:(_.isString(a)?(b=moment(a,this.format.date.display),b.isValid()||(b=moment(a,this.format.date.mysql))):b=moment(a),b.format(this.format.date.mysql))},this.formatTimeForDisplay=function(a){var b;return _.isUndefined(a)||_.isNull(a)?void 0:(_.isString(a)?(b=moment(a,this.format.time.mysql),b.isValid()||(b=moment(a,this.format.time.display))):b=moment(a),b.format(this.format.time.display))},this.formatTimeForMySQL=function(a){var b;return _.isUndefined(a)||_.isNull(a)?void 0:(_.isString(a)?(b=moment(a,this.format.time.display),b.isValid()||(b=moment(a,this.format.time.mysql))):b=moment(a),b.format(this.format.time.mysql))},this.formatMultiSelectForDisplay=function(a,b){var c=[];return _.forEach(a.options,function(a){_.has(b,a.value)&&b[a.value]===!0&&c.push(a.value)}),c},this.formatMultiSelectForMySQL=function(a,b,c){_.forEach(a.options,function(a){_.has(b,a.value)&&(b[a.value]=_.includes(b[c],a.value)?!0:!1)}),delete b[c]},this.formatDecimalForMySQL=function(a){return _.isUndefined(a)?void 0:parseFloat(a).toFixed(2)}};angular.module("AngularDynamicForm").constant("DynamicFormUtilLib",new a)}(),angular.module("AngularDynamicForm").run(["$templateCache",function(a){a.put("views/dynamic-form-fieldset.html",'<fieldset class="{{style_config.fieldset_class}}" ng-class="{\n    \'has-feedback\': config.has_validation_feedback,\n    \'has-success\': errors.length === 0 && show_validation,\n    \'has-error\': errors.length > 0 && show_validation,\n    \'required\': field.validate}">\n\n    <label ng-if="field.label !== \'\' && config.show_labels" for="{{field.name}}"\n           class="{{style_config.label_class}}">{{field.label}}</label>\n\n    <!-- edit state -->\n\n    <div class="{{style_config.input_box_class}}">\n\n\n        <div ng-include src="input_view_template"></div>\n\n        <!-- validation feedback -->\n        <span ng-show="config.has_validation_feedback"\n              class="{{style_config.validation_feedback_class}} glyphicon"\n              ng-class="{\n              \'glyphicon-ok\': errors.length === 0 && show_validation,\n              \'glyphicon-remove\': errors.length > 0 && show_validation\n              }"></span>\n\n\n    </div>\n\n    <!-- indicators -->\n    <div ng-show="field.required && config.has_required_indicator" class="{{style_config.required_indicator_class}}">\n        <span>*</span>\n    </div>\n\n    <div ng-show="errors.length > 0 && show_validation"\n         class="{{style_config.message_box_class}}">{{errors[0]}}</div>\n\n</fieldset>'),a.put("views/dynamic-form-groups.html",'<!-- form -->\n<form role="form" class="form-horizontal">\n\n    <!-- form groups -->\n    <div ng-if="has_groups"\n         class="panel panel-default form-section"\n         ng-repeat="(key, group) in grouped_fields_array | groupBy: \'group_order\'">\n\n        <div class="panel-heading">{{group[0].group_label}}</div>\n        <div class="panel-body">\n\n            <dynamic-form-fieldset class="dynamic-form-fieldset"\n                                   ng-repeat="field in group" field="field" model="model"\n                                   config="form_field_config" style-config="form_style_config"\n                                   errors="errors[field.name]" show-validation="errors[field.name]"></dynamic-form-fieldset>\n\n        </div>\n    </div>\n</form><!-- /form -->'),a.put("views/dynamic-form-no-groups.html",'<!-- form -->\n<form role="form" class="form-horizontal">\n\n    <!-- no form groups -->\n    <dynamic-form-fieldset class="dynamic-form-fieldset"\n                           ng-if="!has_groups"\n                           ng-repeat="field in fields_array" field="field" model="model"\n                           config="form_field_config" style-config="form_style_config"\n                           errors="errors[field.name]" show-validation="errors[field.name]"></dynamic-form-fieldset>\n</form><!-- /form -->\n\n'),a.put("views/dynamic-form.html",'<!-- message -->\n<div class="message-container" move-with-scroll suppress="form_config.scroll_message">\n\n    <div ng-messages="message_state" class="message">\n        <div class="{{form_style_config.message_success_class}}" role="alert"\n             ng-message="success" ng-if="message.success && form_config.show_success_messages">{{message.success}}</div>\n        <div class="{{form_style_config.message_error_class}}" role="alert"\n             ng-message="error" ng-if="message.error && form_config.show_error_messages">{{message.error}}</div>\n    </div>\n</div>\n\n<!-- form -->\n<div ng-include src="form_view_template"></div>\n\n<!-- buttons -->\n<div>\n    <button ng-show="form_config.show_submit_button" type="submit"\n            class="{{form_style_config.submit_button_class}}"\n            ng-click="ctrl.onSubmit()">{{form_config.submit_button_label}}</button>\n\n    <button ng-show="form_config.show_cancel_button" type="button"\n            class="{{form_style_config.submit_cancel_class}}"\n            ng-click="ctrl.onCancel()">{{form_config.cancel_button_label}}</button>\n\n    <button ng-show="form_config.show_clear_button" type="button"\n            class="{{form_style_config.submit_clear_class}}"\n            ng-click="ctrl.onClear()">{{form_config.clear_button_label}}</button>\n</div>'),a.put("views/inputs/checkbox-list.html",'<!-- checkbox-list -->\n<label ng-repeat="option in field.options">\n    <input type="checkbox" checklist-model="model[field.name]" checklist-value="option.value"> {{option.label}}\n</label>'),a.put("views/inputs/checkbox.html",'<!-- checkbox -->\n<input type="checkbox"\n       ng-model="model[field.name]"\n       ng-change="ctrl.onChange()" ng-disabled="model.form_field_config[field.name].disabled">\n'),a.put("views/inputs/currency.html",'<!-- currency -->\n<div class="input-group">\n    <div class="input-group-addon">{{field.symbol}}</div>\n    <input type="text" id="{{field.name}}" class="form-control" placeholder="{{field.label}}"\n           ng-model="model[field.name]" ng-change="ctrl.onChange()" ng-blur="ctrl.onBlur()" ng-disabled="model.form_field_config[field.name].disabled" ng-autofocus="field.autofocus">\n</div>'),a.put("views/inputs/multi-select.html",'<!-- multi-select -->\n<select class="form-control"\n        ng-model="model[field.name]" multiple size="{{field.type.size}}" ng-options="option.value as option.label for option in field.options"\n        ng-change="ctrl.onChange()" ng-disabled="model.form_field_config[field.name].disabled" ng-autofocus="field.autofocus">\n</select>'),a.put("views/inputs/password.html",'<!-- password -->\n<input type="password" id="{{field.name}}" class="form-control" placeholder="{{field.label}}"\n           ng-model="model[field.name]" ng-change="ctrl.onChange()" ng-blur="ctrl.onBlur()" ng-disabled="model.form_field_config[field.name].disabled" ng-autofocus="field.autofocus">\n'),a.put("views/inputs/select.html",'<!-- select -->\n<select class="form-control"\n        ng-model="model[field.name]" ng-options="option.value as option.label for option in field.options"\n        ng-change="ctrl.onChange()" ng-disabled="model.form_field_config[field.name].disabled" ng-autofocus="field.autofocus">\n    <option value="" disabled>Please select</option>\n</select>'),a.put("views/inputs/text.html",'<!-- text -->\n<input type="text" id="{{field.name}}" class="{{style_config.input_class}}" placeholder="{{field.label}}"\n       ng-model="model[field.name]" ng-change="ctrl.onChange()" ng-blur="ctrl.onBlur()" ng-disabled="model.form_field_config[field.name].disabled" ng-autofocus="field.autofocus">\n'),a.put("views/inputs/textarea.html",'<!-- textarea -->\n<textarea id="{{field.name}}" class="form-control" placeholder="{{field.label}}"\n          ng-model="model[field.name]" ng-change="ctrl.onChange()" ng-blur="ctrl.onBlur()" ng-disabled="model.form_field_config[field.name].disabled" ng-autofocus="field.autofocus"></textarea>\n')}]),function(){var a="AngularDynamicForm: ";angular.module("AngularDynamicForm").constant("DYNAMIC_FORM_EVENTS",{init:"dynamic-form:init",valid:"dynamic-form:valid",invalid:"dynamic-form:invalid",processSuccess:"dynamic-form:process-success",processError:"dynamic-form:process-error",submit:"dynamic-form:submit",forceSubmit:"dynamic-form:force-submit",validate:"dynamic-form:validate"}).constant("MESSAGE_EXTERNAL_METHOD_ERROR",a+"Custom method must handle its own errors").constant("MESSAGE_EXTERNAL_METHOD_INVALID_RETURN",a+"Custom method must return either Boolean value or Promise").constant("MESSAGE_INVALID_STEP",a+"Invalid step").constant("MESSAGE_UNRECOGNISED_STEP_NAME",a+"Unrecognised step name").constant("MESSAGE_INVALID_CONFIG",a+"Invalid config").constant("MESSAGE_INVALID_FIELDS_OBJECT",a+"Invalid fields object").constant("MESSAGE_INVALID_OPTIONS_ARRAY",a+"Invalid options array").constant("MESSAGE_INVALID_OPTIONS_OBJECT",a+"Invalid options object").constant("MESSAGE_UNRECOGNISED_CONFIG_NAME",a+"Unrecognised config name").constant("MESSAGE_INVALID_MODEL_METHOD",a+"Invalid model method")}(),function(){var a=function(){var a=this;this.validateAllFields=function(b,c){var d=!0,e={},f={};return _.has(b,"validation_rules")&&!_.isEmpty(b.validation_rules)&&angular.extend(f,b.validation_rules),_.isEmpty(c)||angular.extend(f,c),_.isUndefined(f)||_.forEach(b,function(c,g){_.has(f,g)&&(_.has(f[g],"presence")&&!f[g].presence||(e[g]=a.validateField(b,g),e[g].length>0&&(d=!1)))}),{errors:e,is_valid:d}},this.validateField=function(a,b){var c=[];a.clearErrors();var d=a.validate(b);return d||(c=a.$errors[b]),c}};angular.module("AngularDynamicForm").service("DynamicFormService",a)}(),function(){var a=function(a,b,c,d,e,f,g){var h=this;b.submit_step;var i=["model"];this.default_submit_steps=["validate","save"],b.message={},b.message_state={success:!1,error:!1},this.onClear=function(){_.forEach(b.model,function(a,c){_.contains(i,c)||(b.model[c]=void 0)},this),_.isUndefined(b.onClear)||b.onClear("")},this.onCancel=function(){_.isUndefined(b.onCancel)||b.onCancel("")},this.onSubmit=function(){this.busy=!0;var a=_.isUndefined(b.submit_steps)?this.default_submit_steps:b.submit_steps;g.handleSubmit(a,b.model,b.form_config).then(function(a){_.isUndefined(b.onSubmitComplete)||b.onSubmitComplete(a)},function(a){_.isUndefined(b.onError)||b.onError(a)},function(a){console.log("STEP ::::: "+a.step),b.errors=a.data;var c;switch(a.step){case"validate":c="validation_"+a.message_state+"_message";break;case"save":c="save_"+a.message_state+"_message"}h.showMessage(a.message_state,b.form_config[c])})},this.init=function(){b.form_config=f.transformConfig("form",b.form_config),b.form_style_config=f.transformConfig("form_style",b.form_style_config),b.form_field_config=f.transformConfig("form_field",b.form_field_config),b.fields_array=e.transformFields(b.fields,b.form_config,b.model),b.has_groups&&(b.grouped_fields_array=e.transformGroupFields(b.fields_array,b.groups_config)),this.busy=!1},this.showMessage=function(a,c){this.hideMessage(),b.message[a]=c,b.message_state[a]=!0},this.hideMessage=function(){b.message={},_.forEach(b.message_state,function(a){a=!1})};var j=b.$watch("model",function(a){_.isUndefined(a)||(h.init(),j())})};a.$inject=["$rootScope","$scope","$q","DYNAMIC_FORM_EVENTS","AngularDynamicForm.transformers.FieldTransformer","AngularDynamicForm.transformers.ConfigTransformer","AngularDynamicForm.helpers.SubmitService","DynamicFormUtilLib","DynamicFormStateService"],angular.module("AngularDynamicForm").controller("DynamicFormCtrl",a)}(),function(){var a=function(){return{restrict:"E",scope:{model:"=",fields:"=",form_config:"=config",form_field_config:"=fieldConfig",form_style_config:"=styleConfig",groups_config:"=groupsConfig",submit_steps:"=submitSteps",onSubmitComplete:"&",onCancel:"&",onClear:"&",onError:"&"},controller:"DynamicFormCtrl as ctrl",link:function(a,b,c){b.addClass("dynamic-form"),_.isUndefined(a.groups_config)?(a.has_groups=!1,a.form_view_template="views/dynamic-form-no-groups.html"):(a.has_groups=!0,a.form_view_template="views/dynamic-form-groups.html"),_.has(c,"onSubmitComplete")||delete a.onSubmitComplete,_.has(c,"onCancel")||delete a.onCancel,_.has(c,"onClear")||delete a.onClear,_.has(c,"onError")||delete a.onError},templateUrl:"views/dynamic-form.html"}};a.$inject=[],angular.module("AngularDynamicForm").directive("dynamicForm",a)}(),function(){var a=function(a,b,c,d,e){var f,g,h,i=this,j=null,k=null,l=null;this.handleSubmit=function(b,c,d){f=c,g=d;var e=a.defer();return k=e.resolve,j=e.notify,l=e.reject,i.handleSubmitSteps(0,b),e.promise},this.handleSubmitSteps=function(a,b){return a=_.isUndefined(a)?0:a,a>=b.length?void(_.isNull(k)||k()):void i.handleSubmitStep(a,b).then(function(c){h=c,_.isObject(c)||(c={}),c.message_state="success",c.step=_.isString(b[a])?b[a]:"custom",_.isNull(j)||j(c),i.handleSubmitSteps(++a,b)},function(c){return h=c,"validate"===b[a]||"save"===b[a]?(_.isObject(c)||(c={}),c.message_state="error",c.step=b[a],void(_.isNull(j)||j(c))):void i.handleError(c)})},this.handleSubmitStep=function(b,e){return a(function(a,f){if(!_.isFunction(e[b])&&!_.isString(e[b]))throw new Error(d);return _.isFunction(e[b])?void c.callExternalMethod(e[b],h).then(a,f):void i.handleSubmitStepInternalMethod(b,e).then(a,f)})},this.handleSubmitStepInternalMethod=function(a,b){var c=b[a];if(!_.has(i.internal_methods,c))throw new Error(e);switch(c){case"validate":return i.internal_methods.validate(f,g);default:return i.internal_methods[c]()}},this.handleError=function(a){return _.isNull(l)?void console.error(a):void l(a)},this.save=function(){return console.log("Step X: save"),c.callExternalMethod(f.save,[],f)},this.internal_methods={validate:b.validate,save:this.save}};a.$inject=["$q","AngularDynamicForm.validation.ValidationService","AngularDynamicForm.helpers.ExternalCallService","MESSAGE_INVALID_STEP","MESSAGE_UNRECOGNISED_STEP_NAME"],angular.module("AngularDynamicForm").service("AngularDynamicForm.helpers.SubmitService",a)}(),function(){var a=function(a,b,c){this.callExternalMethod=function(d,e,f){return a(function(a,g){var h;try{h=_.isUndefined(f)?d(e):d.apply(f,e)}catch(i){throw new Error(b)}if(_.isUndefined(h))throw new Error(c);if(h===!1||h===!0)h?a(null):g(null);else try{h.then(a,g)}catch(i){throw new Error(i instanceof TypeError?c:b)}})}};a.$inject=["$q","MESSAGE_EXTERNAL_METHOD_ERROR","MESSAGE_EXTERNAL_METHOD_INVALID_RETURN"],angular.module("AngularDynamicForm").service("AngularDynamicForm.helpers.ExternalCallService",a)}(),function(){var a=function(a,b){this.validate=function(d,e){return console.log("Step X: validate"),console.log(d),console.log(e),a(function(a,f){var g=c(d,e);b.callExternalMethod(d.validate,[g],d).then(a,f)})};var c=function(a,b){var c=[];return _.isNull(b.validate_fields)?_.isNull(b.validate_fields_exclude)||_.forEach(a,function(a,d){_.include(b.validate_fields_exclude,d)||_.include(b.validate_fields,d)||c.push(d)}):c=b.validate_fields,c}};a.$inject=["$q","AngularDynamicForm.helpers.ExternalCallService"],angular.module("AngularDynamicForm").service("AngularDynamicForm.validation.ValidationService",a)}(),function(){var a=function(a){var b={label_camelcase:!0,label_replace_underscores:!0,show_error_messages:!0,show_success_messages:!0,show_submit_button:!0,show_cancel_button:!0,show_clear_button:!0,submit_button_label:"SUBMIT",cancel_button_label:"CANCEL",clear_button_label:"CLEAR",validate_fields:null,validate_fields_exclude:null,validation_error_message:"Please complete all required fields",validation_success_message:"Form is valid",save_error_message:"There was an error saving",save_success_message:"Save complete"},c={has_messages:!0,has_groups:!0,show_labels:!0,has_validation_feedback:!0,has_required_indicator:!0},d={fieldset_class:"",label_class:"",input_box_class:"",input_class:"",validation_feedback_class:"",required_indicator_class:"",message_box_class:"",submit_button_class:"",cancel_button_class:"",clear_button_class:"",message_error_class:"",message_success_class:""};this.config={form:b,form_field:c,form_style:d},this.transformConfig=function(b,c){if(!_.has(this.config,b))throw new Error(a);return _.merge(_.clone(this.config[b]),c)}};a.$inject=["MESSAGE_UNRECOGNISED_CONFIG_NAME"],angular.module("AngularDynamicForm").service("AngularDynamicForm.transformers.ConfigTransformer",a)}(),function(){var a=function(a,b,c,d){var e=["label_camelcase","label_replace_underscores"],f=["type"],g=["label","value"],h={text:{type:"text",required:!1},textarea:{type:"textarea",required:!1},currency:{type:"currency",symbol:"$",required:!1},password:{type:"password",required:!1},checkbox:{type:"checkbox",required:!1},select:{type:"select",options:[],required:!1},"checkbox-list":{type:"checkbox-list",options:[],required:!1},"multi-select":{type:"select",options:[],size:4,required:!1}};this.transformFields=function(c,d,g){var h=[];if(0!==_.difference(e,_.keys(d)).length)throw new Error(a);return _.forEach(c,function(a,c){if(0!==_.difference(f,_.keys(a)).length)throw new Error(b);var e=i(a,c,d,g[c]);h.push(e)}),h},this.transformGroupFields=function(a,b){var c=[];return _.forEach(a,function(a){var d=1;_.forEach(b,function(b){_.forEach(b.fields,function(e,f){if(e===a.name){var g=_.clone(a);g.group_label=b.label,_.has(b,"order")&&(d=b.order),g.group_order=d,g.order=f,c.push(g)}c=_.sortBy(c,"order")},this),d++},this)},this),c=_.sortBy(c,"group_order")};var i=function(a,b,e,f){var i={};if(_.has(h,a.type)){if(_.has(a,"options")){if(!_.isArray(a.options))throw new Error(c);_.forEach(a.options,function(a){if(0!==_.difference(g,_.keys(a)).length)throw new Error(d)})}i=_.merge(_.clone(h[a.type]),a)}else i=_.clone(a);return _.has(i[b],"label")||(i.label=j(b,e.label_camelcase,e.label_replace_underscores)),i.name=b,i.model=f,i.validate=!1,i},j=function(a,b,c){return c&&(a=a.replace(/\_/g," ")),b&&(a=_.startCase(a)),a}};a.$inject=["MESSAGE_INVALID_CONFIG","MESSAGE_INVALID_FIELDS_OBJECT","MESSAGE_INVALID_OPTIONS_ARRAY","MESSAGE_INVALID_OPTIONS_OBJECT"],angular.module("AngularDynamicForm").service("AngularDynamicForm.transformers.FieldTransformer",a)}(),function(){var a=function(){this.formatDecimal=function(a,b){return _.isUndefined(a)||(a=a.replace(b,"")),parseFloat(a).toFixed(2)}};angular.module("AngularDynamicForm").service("DynamicFormFieldsetService",a)}(),function(){var a=function(a,b,c){var d=this;a.search_query="",this.search_result,this.selected_product,this.new_pin=a.model[a.field.name]?"* * * *":"",this.google_place=a.model.google_place,a.datepicker_format="dd-MM-yyyy",this.onChange=function(b,d){_.isUndefined(d)&&_.isUndefined(b)&&(b=d),a.field.validate&&(a.errors=c.validateField(a.model,a.field.name),a.show_validation=!0)},this.onBlur=function(){a.field.validate&&(a.errors=c.validateField(a.model,a.field.name),a.show_validation=!0)},this.arrayContains=function(a,b,c){if(_.isUndefined(c))return _.contains(a,b);var d=!1;return _.forEach(a,function(a){a[c]===b&&(d=!0)}),d},this.onGooglePlaceToggle=function(){this.google_place_manual=!this.google_place_manual,this.google_place_manual&&(a.model.google_place="")},this.onGooglePlaceClick=function(){this.google_place=null},this.onGooglePlaceSelect=function(b){a.model.google_place=b.place_id,a.field.query=b.formatted,this.google_place=b},this.onModelSearchSelectSelect=function(b){_.has(b,"id")&&!_.isUndefined(b.id)&&a.field.model.view(_.parseInt(b.id)).then(function(b){_.isArray(a.model[a.field.name])||(a.model[a.field.name]=[]),_.includes(_.pluck(a.model[a.field.name],"id"),b.data.id)||a.model[a.field.name].push(b.data)})},this.generateNewPin=function(a,b){b.model.api("generateNewPin").then(function(c){b[a]=c.data.data,d.new_pin=c.data.data,d.new_pin_generated=!0})}};a.$inject=["$scope","$timeout","DynamicFormService"],angular.module("AngularDynamicForm").controller("DynamicFormFieldsetCtrl",a)}(),function(){var a=function(){return{restrict:"E",scope:{field:"=",model:"=",errors:"=",show_validation:"=showValidation",config:"=",style_config:"=styleConfig"},controller:"DynamicFormFieldsetCtrl as ctrl",replace:!0,link:function(a,b){b.addClass("dynamic-form-fieldset"),a.input_view_template="views/inputs/"+a.field.type+".html"},templateUrl:"views/dynamic-form-fieldset.html"}};a.$inject=[],angular.module("AngularDynamicForm").directive("dynamicFormFieldset",a)}();
//# sourceMappingURL=angular-dynamic-form.tmpl.min.js.map